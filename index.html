<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SportIQ ULTRA</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Heebo:wght@300;400;600;800;900&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root {
  --bg:     #02040a;
  --bg2:    #080e1a;
  --panel:  #0c1220;
  --panel2: #111927;
  --border: rgba(0,240,255,0.08);
  --b2:     rgba(255,255,255,0.05);
  --cyan:   #00f0ff;
  --green:  #00ff88;
  --red:    #ff3b5c;
  --gold:   #ffd94a;
  --text:   #e8f4f8;
  --dim:    #4a6070;
  --dim2:   #1e2d3d;
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;overflow:hidden}
body{background:var(--bg);color:var(--text);font-family:'Heebo',sans-serif;direction:rtl}
body::before{
  content:'';position:fixed;inset:0;pointer-events:none;
  background:
    radial-gradient(ellipse 70% 50% at 25% 0%,rgba(0,240,255,0.04) 0%,transparent 60%),
    radial-gradient(ellipse 50% 40% at 80% 100%,rgba(0,255,136,0.03) 0%,transparent 50%);
}

/* â”€â”€ SHELL â”€â”€ */
.shell{display:grid;grid-template-columns:60px 1fr;height:100vh;position:relative;z-index:1}

/* â”€â”€ SIDEBAR â”€â”€ */
.sidebar{
  background:#000;border-left:1px solid var(--border);
  display:flex;flex-direction:column;align-items:center;padding:16px 0;gap:4px
}
.logo{
  font-family:'Space Mono',monospace;font-size:.7rem;font-weight:700;
  color:var(--cyan);writing-mode:vertical-rl;transform:rotate(180deg);
  letter-spacing:.15em;margin-bottom:20px
}
.sicon{
  width:42px;height:42px;border-radius:10px;border:1px solid transparent;
  background:none;font-size:1.2rem;cursor:pointer;display:flex;
  align-items:center;justify-content:center;opacity:.3;transition:.2s;color:#fff
}
.sicon:hover{opacity:.7;background:rgba(255,255,255,.04)}
.sicon.on{opacity:1;border-color:var(--cyan);background:rgba(0,240,255,.08);box-shadow:0 0 12px rgba(0,240,255,.2)}
.sdot{width:7px;height:7px;border-radius:50%;background:var(--green);
  box-shadow:0 0 8px var(--green);margin-top:auto;margin-bottom:8px;
  animation:blink 2s infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.4}}

/* â”€â”€ MAIN â”€â”€ */
.main{display:flex;flex-direction:column;padding:16px 18px;gap:14px;overflow:hidden;min-width:0}

/* â”€â”€ HEADER â”€â”€ */
.hdr{display:flex;align-items:center;justify-content:space-between;flex-shrink:0}
.hdr h1{font-family:'Space Mono',monospace;font-size:1.25rem;font-weight:700}
.hdr h1 span{color:var(--cyan)}
.hpills{display:flex;align-items:center;gap:8px}
.pill{
  font-family:'Space Mono',monospace;font-size:.58rem;padding:3px 10px;
  border-radius:20px;letter-spacing:.08em;border:1px solid;
}
.pcyan{color:var(--cyan);border-color:rgba(0,240,255,.3);background:rgba(0,240,255,.08)}
.pgreen{color:var(--green);border-color:rgba(0,255,136,.3);background:rgba(0,255,136,.08)}
.pred{color:var(--red);border-color:rgba(255,59,92,.3);background:rgba(255,59,92,.08)}
.pgold{color:var(--gold);border-color:rgba(255,217,74,.3);background:rgba(255,217,74,.1)}
.clk{font-family:'Space Mono',monospace;font-size:.7rem;color:var(--dim)}
.stabs{display:flex;gap:4px;background:rgba(0,0,0,.5);border:1px solid var(--border);padding:4px;border-radius:10px}
.stab{
  padding:5px 14px;border-radius:7px;border:none;background:none;
  color:var(--dim);font-family:'Heebo',sans-serif;font-size:.82rem;
  font-weight:600;cursor:pointer;transition:.2s;white-space:nowrap
}
.stab:hover{color:var(--text)}
.stab.on{background:var(--cyan);color:#000;font-weight:800}

/* â”€â”€ GRID â”€â”€ */
.grid{display:grid;grid-template-columns:300px 1fr;gap:14px;flex:1;overflow:hidden;min-height:0}

/* â”€â”€ LEFT PANEL â”€â”€ */
.lpanel{
  background:var(--panel);border:1px solid var(--border);border-radius:16px;
  display:flex;flex-direction:column;overflow:hidden;min-height:0
}
.phdr{
  padding:14px 16px 10px;border-bottom:1px solid var(--border);
  display:flex;align-items:center;justify-content:space-between;flex-shrink:0
}
.phdr h3{font-size:.82rem;font-weight:700;letter-spacing:.02em}
.rbtn{
  background:none;border:1px solid var(--border);border-radius:7px;
  color:var(--dim);font-size:.65rem;padding:3px 9px;cursor:pointer;
  transition:.2s;font-family:'Heebo',sans-serif
}
.rbtn:hover{border-color:var(--cyan);color:var(--cyan)}
.mscroll{flex:1;overflow-y:auto;padding:8px}
.mscroll::-webkit-scrollbar{width:3px}
.mscroll::-webkit-scrollbar-thumb{background:var(--dim2);border-radius:2px}

/* â”€â”€ MATCH CARD â”€â”€ */
.mc{
  background:var(--panel2);border:1px solid transparent;border-radius:11px;
  padding:11px 13px;margin-bottom:7px;cursor:pointer;transition:.18s
}
.mc:hover{border-color:rgba(0,240,255,.2)}
.mc.on{border-color:var(--cyan);background:rgba(0,240,255,.04);box-shadow:0 0 16px rgba(0,240,255,.07)}
.mc-lg{font-size:.6rem;color:var(--cyan);font-weight:600;letter-spacing:.04em;margin-bottom:7px;display:flex;align-items:center;gap:6px}
.mc-teams{display:grid;grid-template-columns:1fr auto 1fr;align-items:center;gap:7px;margin-bottom:7px}
.mc-tn{font-size:.8rem;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.mc-tn.away{text-align:left}
.mc-score{
  background:rgba(0,0,0,.5);border:1px solid var(--border);
  border-radius:7px;padding:4px 9px;font-family:'Space Mono',monospace;
  font-size:.85rem;font-weight:700;text-align:center;min-width:48px
}
.mc-foot{display:flex;align-items:center;justify-content:space-between}
.mc-time{font-family:'Space Mono',monospace;font-size:.58rem;display:flex;align-items:center;gap:4px}
.mc-time.live{color:var(--red)}
.mc-time.sched{color:var(--gold)}
.probbar{height:3px;border-radius:2px;background:var(--dim2);margin-top:6px;display:flex;overflow:hidden}
.pbh{background:var(--green)}.pbd{background:var(--gold);opacity:.7}.pba{background:var(--red);opacity:.7}
.vbadge{font-size:.52rem;padding:2px 6px;border-radius:6px;font-weight:700;letter-spacing:.06em}
.vhot{background:rgba(0,255,136,.15);color:var(--green);border:1px solid rgba(0,255,136,.25)}
.vedge{background:rgba(255,217,74,.12);color:var(--gold);border:1px solid rgba(255,217,74,.2)}

/* â”€â”€ RIGHT PANEL â”€â”€ */
.rpanel{
  background:var(--panel);border:1px solid var(--border);border-radius:16px;
  display:flex;flex-direction:column;overflow:hidden;min-height:0
}
.ph{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:10px;color:var(--dim)}
.phicon{font-size:2.5rem;opacity:.25;animation:fl 3s ease-in-out infinite}
@keyframes fl{0%,100%{transform:translateY(0)}50%{transform:translateY(-7px)}}
.ph p{font-size:.8rem}

/* â”€â”€ ANALYSIS â”€â”€ */
.ac{display:flex;flex-direction:column;height:100%;min-height:0}
.atop{padding:16px 18px 0;flex-shrink:0}
.amatch{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
.amatch h2{font-family:'Space Mono',monospace;font-size:.95rem;font-weight:700}
.atabrow{display:flex;gap:2px;border-bottom:1px solid var(--border)}
.atab{
  background:none;border:none;color:var(--dim);font-family:'Heebo',sans-serif;
  font-size:.78rem;font-weight:600;padding:7px 12px;cursor:pointer;position:relative;transition:.15s
}
.atab::after{
  content:'';position:absolute;bottom:-1px;left:0;right:0;
  height:2px;background:var(--cyan);transform:scaleX(0);transition:.2s
}
.atab.on{color:var(--cyan)}
.atab.on::after{transform:scaleX(1)}
.atab:hover:not(.on){color:var(--text)}
.abody{flex:1;overflow-y:auto;padding:14px 18px}
.abody::-webkit-scrollbar{width:3px}
.abody::-webkit-scrollbar-thumb{background:var(--dim2);border-radius:2px}
.tc{display:none}
.tc.on{display:block}

/* â”€â”€ STATS â”€â”€ */
.sg3{display:grid;grid-template-columns:repeat(3,1fr);gap:9px;margin-bottom:14px}
.sg2{display:grid;grid-template-columns:repeat(2,1fr);gap:9px;margin-bottom:14px}
.sg4{display:grid;grid-template-columns:repeat(4,1fr);gap:9px;margin-bottom:14px}
.sc{
  background:var(--bg2);border:1px solid var(--b2);border-radius:9px;
  padding:11px 13px
}
.sc label{display:block;font-size:.58rem;color:var(--dim);letter-spacing:.04em;margin-bottom:3px;text-transform:uppercase}
.sc b{font-size:1rem;font-family:'Space Mono',monospace;color:var(--text)}
.sc.ca{border-right:3px solid var(--cyan)}
.sc.cg{border-right:3px solid var(--green)}
.sc.co{border-right:3px solid var(--gold)}
.sc.cr{border-right:3px solid var(--red)}

/* â”€â”€ FORM BADGES â”€â”€ */
.form-row{display:flex;align-items:center;gap:8px;margin-bottom:12px;flex-wrap:wrap}
.form-label{font-size:.72rem;color:var(--dim);min-width:80px;font-weight:600}
.fb{
  width:26px;height:26px;border-radius:6px;display:flex;align-items:center;
  justify-content:center;font-size:.7rem;font-weight:700;font-family:'Space Mono',monospace;
  cursor:default;transition:.15s
}
.fb:hover{transform:scale(1.15)}
.fw{background:rgba(0,255,136,.2);color:var(--green);border:1px solid rgba(0,255,136,.4)}
.fd{background:rgba(255,217,74,.15);color:var(--gold);border:1px solid rgba(255,217,74,.3)}
.fl{background:rgba(255,59,92,.18);color:var(--red);border:1px solid rgba(255,59,92,.35)}

/* â”€â”€ H2H â”€â”€ */
.h2h-row{
  display:grid;grid-template-columns:1fr auto 1fr;align-items:center;gap:10px;
  background:var(--bg2);border:1px solid var(--b2);border-radius:8px;
  padding:7px 11px;margin-bottom:6px;font-size:.75rem
}
.h2r{
  text-align:center;font-family:'Space Mono',monospace;font-size:.78rem;
  font-weight:700;padding:3px 10px;border-radius:6px
}
.rh{background:rgba(0,255,136,.1);color:var(--green)}
.rd{background:rgba(255,217,74,.1);color:var(--gold)}
.ra{background:rgba(255,59,92,.1);color:var(--red)}
.h2h-date{font-size:.58rem;color:var(--dim);margin-top:2px}

/* â”€â”€ ODDS â”€â”€ */
.odds3{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:14px}
.ocard{
  background:var(--bg2);border:1px solid var(--b2);border-radius:11px;
  padding:14px 10px;text-align:center;cursor:pointer;transition:.2s;position:relative
}
.ocard::before{
  content:attr(data-l);position:absolute;top:6px;right:10px;
  font-size:.5rem;color:var(--dim);letter-spacing:.1em;
  text-transform:uppercase;font-family:'Space Mono',monospace
}
.ocard:hover{border-color:var(--cyan)}
.ocard.pick{border-color:var(--cyan);background:rgba(0,240,255,.05)}
.oval{font-family:'Space Mono',monospace;font-size:1.7rem;font-weight:700;color:var(--cyan);display:block;margin:8px 0 4px}
.oprob{font-size:.68rem;color:var(--dim);display:block}
.otrend{font-size:.6rem;display:block;margin-top:3px}
.tu{color:var(--green)}.td2{color:var(--red)}

/* â”€â”€ AI BOX â”€â”€ */
.aibox{
  background:linear-gradient(135deg,rgba(0,240,255,.04),rgba(0,255,136,.02));
  border:1px solid rgba(0,240,255,.14);border-radius:11px;padding:14px;margin-bottom:14px
}
.aihdr{font-family:'Space Mono',monospace;font-size:.52rem;color:var(--dim);
  letter-spacing:.14em;margin-bottom:10px}
.confrow{display:flex;align-items:center;gap:10px;margin-bottom:10px}
.confl{font-size:.65rem;color:var(--dim)}
.confbar{flex:1;height:5px;background:var(--bg);border-radius:3px;overflow:hidden}
.conff{height:100%;border-radius:3px;transition:width .8s ease}
.confpct{font-family:'Space Mono',monospace;font-size:.75rem;font-weight:700;min-width:34px;text-align:left}
.airec{font-size:.8rem;color:var(--text);line-height:1.6}
.hl{color:var(--cyan);font-weight:700}
.krow{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}
.kb{background:rgba(0,0,0,.4);border:1px solid var(--b2);border-radius:7px;padding:5px 11px;font-size:.68rem}
.kb span{color:var(--cyan);font-family:'Space Mono',monospace;font-weight:700}

/* â”€â”€ PLAYERS â”€â”€ */
.plist{display:flex;flex-direction:column;gap:5px}
.prow{
  display:flex;justify-content:space-between;align-items:center;
  padding:7px 11px;background:var(--bg2);border-radius:7px;
  font-size:.75rem;border:1px solid transparent
}
.prow.inj{border-color:rgba(255,59,92,.2)}
.prow.doubt{border-color:rgba(255,217,74,.15)}
.pstat{font-size:.6rem;padding:2px 7px;border-radius:5px}
.sinj{background:rgba(255,59,92,.15);color:var(--red)}
.sdoubt{background:rgba(255,217,74,.12);color:var(--gold)}

/* â”€â”€ CHART â”€â”€ */
.csec{
  background:var(--bg2);border:1px solid var(--b2);border-radius:11px;
  padding:13px;margin-bottom:14px
}
.ctitle{font-family:'Space Mono',monospace;font-size:.58rem;color:var(--dim);
  letter-spacing:.1em;text-transform:uppercase;margin-bottom:10px}
.csec canvas{height:110px!important}

/* â”€â”€ SECTION TITLE â”€â”€ */
.st{
  font-family:'Space Mono',monospace;font-size:.58rem;color:var(--dim);
  letter-spacing:.12em;text-transform:uppercase;margin:12px 0 8px
}

/* â”€â”€ TG BTN â”€â”€ */
.tgbtn{
  width:100%;background:linear-gradient(135deg,#0088cc,#0070aa);
  color:#fff;border:none;padding:11px;border-radius:9px;
  font-family:'Heebo',sans-serif;font-weight:700;font-size:.82rem;
  cursor:pointer;margin-top:12px;transition:.2s
}
.tgbtn:hover{filter:brightness(1.15);transform:translateY(-1px)}

/* â”€â”€ LOADING â”€â”€ */
.ld{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:32px 16px;gap:10px;color:var(--dim)}
.spin{width:24px;height:24px;border:2px solid var(--dim2);border-top-color:var(--cyan);border-radius:50%;animation:sp .7s linear infinite}
@keyframes sp{to{transform:rotate(360deg)}}

/* â”€â”€ TEAM SEARCH â”€â”€ */
.tsearch{
  padding:8px;border-bottom:1px solid var(--border);flex-shrink:0
}
.tsearch input{
  width:100%;background:var(--bg2);border:1px solid var(--border);
  border-radius:8px;padding:7px 12px;color:var(--text);font-family:'Heebo',sans-serif;
  font-size:.8rem;outline:none;direction:rtl;transition:.2s
}
.tsearch input:focus{border-color:var(--cyan)}
.tsearch input::placeholder{color:var(--dim)}

/* â”€â”€ TOAST â”€â”€ */
.toast{
  position:fixed;bottom:16px;left:50%;transform:translateX(-50%) translateY(16px);
  background:var(--panel2);border:1px solid var(--border);border-radius:9px;
  padding:9px 18px;font-size:.78rem;opacity:0;transition:.3s;z-index:100;
  pointer-events:none;white-space:nowrap
}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
</style>
</head>
<body>
<div class="shell">

  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="logo">SÂ·IÂ·Q</div>
    <button class="sicon on" id="sn-soccer"      onclick="App.setSport('soccer')"     title="×›×“×•×¨×’×œ">âš½</button>
    <button class="sicon"    id="sn-basketball"  onclick="App.setSport('basketball')" title="×›×“×•×¨×¡×œ">ğŸ€</button>
    <div class="sdot" id="sdot"></div>
  </aside>

  <!-- MAIN -->
  <div class="main">

    <!-- HEADER -->
    <header class="hdr">
      <div style="display:flex;align-items:baseline;gap:12px">
        <h1>SportIQ <span>ULTRA</span></h1>
        <div class="hpills">
          <span class="pill pcyan" id="api-st">CONNECTING</span>
          <span class="pill pgreen" id="mode-st" style="display:none">LIVE</span>
          <span class="clk" id="clk">00:00:00</span>
        </div>
      </div>
      <div class="stabs">
        <button class="stab on" id="st-soccer"     onclick="App.setSport('soccer')">âš½ ×›×“×•×¨×’×œ</button>
        <button class="stab"    id="st-basketball" onclick="App.setSport('basketball')">ğŸ€ ×›×“×•×¨×¡×œ</button>
      </div>
    </header>

    <!-- GRID -->
    <div class="grid">

      <!-- LEFT -->
      <section class="lpanel">
        <div class="phdr">
          <div style="display:flex;align-items:center;gap:8px">
            <h3 id="ptitle">××©×—×§×™×</h3>
            <span class="pill pgold" id="pbadge" style="font-size:.52rem">LOADING</span>
          </div>
          <button class="rbtn" onclick="App.refresh()">â†» ×¨×¢× ×Ÿ</button>
        </div>
        <!-- SEARCH BOX -->
        <div class="tsearch">
          <input type="text" id="team-search" placeholder="ğŸ” ×—×¤×© ×§×‘×•×¦×”..." oninput="App.filterMatches(this.value)">
        </div>
        <div class="mscroll" id="match-list">
          <div class="ld"><div class="spin"></div><span>××—×¤×© ××©×—×§×™×...</span></div>
        </div>
      </section>

      <!-- RIGHT -->
      <section class="rpanel">
        <!-- PLACEHOLDER -->
        <div class="ph" id="ph">
          <div class="phicon">ğŸ“Š</div>
          <h3 style="font-size:.9rem">×× ×•×¢ AI Value Bet</h3>
          <p>×‘×—×¨ ××©×—×§ ×œ× ×™×ª×•×— ××¢××™×§</p>
        </div>

        <!-- ANALYSIS -->
        <div class="ac" id="ac" style="display:none">
          <div class="atop">
            <div class="amatch">
              <h2 id="a-title">â€”</h2>
              <div style="display:flex;gap:7px;align-items:center">
                <span class="pill pred" id="a-time">×—×™</span>
                <span class="pill pcyan" id="a-league" style="font-size:.52rem">â€”</span>
              </div>
            </div>
            <div class="atabrow">
              <button class="atab on" onclick="App.tab('ov',this)">ğŸ“ˆ ×¡×§×™×¨×”</button>
              <button class="atab"    onclick="App.tab('odds',this)">ğŸ’° ×™×—×¡×™×</button>
              <button class="atab"    onclick="App.tab('form',this)">ğŸ“‹ ×¤×•×¨×</button>
              <button class="atab"    onclick="App.tab('h2h',this)">âš”ï¸ H2H</button>
              <button class="atab"    onclick="App.tab('squad',this)">ğŸ©º ×”×¨×›×‘</button>
            </div>
          </div>
          <div class="abody">
            <!-- OVERVIEW -->
            <div class="tc on" id="tc-ov">
              <div class="sg3" id="ov-stats"></div>
              <div class="csec">
                <div class="ctitle">âš¡ ××“×“ ×œ×—×¥ ×•××•×× ×˜×•×</div>
                <canvas id="mChart"></canvas>
              </div>
              <div class="sg2" id="ov-extra"></div>
            </div>
            <!-- ODDS -->
            <div class="tc" id="tc-odds">
              <div class="st">×™×—×¡×™× ××—×•×©×‘×™×</div>
              <div class="odds3" id="odds-grid"></div>
              <div class="aibox">
                <div class="aihdr">AI ENGINE Â· VALUE BET ANALYSIS</div>
                <div class="confrow">
                  <span class="confl">×‘×™×˜×—×•×Ÿ</span>
                  <div class="confbar"><div class="conff" id="conff"></div></div>
                  <span class="confpct" id="confpct">â€”</span>
                </div>
                <div class="airec" id="ai-txt">××—×©×‘...</div>
                <div class="krow" id="kelly"></div>
              </div>
              <div class="sg3" id="lg-cmp"></div>
              <button class="tgbtn" onclick="App.tg()">ğŸ“± ×©×œ×— ×œ×˜×œ×’×¨×</button>
            </div>
            <!-- FORM -->
            <div class="tc" id="tc-form">
              <div class="st">5 ××©×—×§×™× ××—×¨×•× ×™×</div>
              <div id="form-home"></div>
              <div id="form-away"></div>
              <div class="sg4" id="form-stats"></div>
            </div>
            <!-- H2H -->
            <div class="tc" id="tc-h2h">
              <div class="st">×¡×˜×˜×™×¡×˜×™×§×•×ª ×¢×™××•×ª ×™×©×™×¨</div>
              <div class="sg3" id="h2h-sum"></div>
              <div class="st">5 ××¤×’×©×™× ××—×¨×•× ×™×</div>
              <div id="h2h-rows"></div>
            </div>
            <!-- SQUAD -->
            <div class="tc" id="tc-squad">
              <div class="sg2" id="squad-grid"></div>
              <div class="st" style="margin-top:14px">ğŸŸ¡ ××©××¢×ª ×•× ×‘×“×œ×™×</div>
              <div class="sg3" id="disc-stats"></div>
            </div>
          </div>
        </div>
      </section>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   API SERVICE â€” SportAPI7 via RapidAPI
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const API = {
  KEY:  '480d7b8455mshb4ee5606f0a42a1p10a646jsn64b65efdb148',
  HOST: 'sportapi7.p.rapidapi.com',
  BASE: 'https://sportapi7.p.rapidapi.com',

  async req(path) {
    const r = await fetch(this.BASE + path, {
      headers: { 'x-rapidapi-key': this.KEY, 'x-rapidapi-host': this.HOST }
    });
    if (!r.ok) throw new Error(`HTTP ${r.status}`);
    return r.json();
  },

  live(sport)           { return this.req(`/api/v1/sport/${sport}/events/live`); },
  sched(sport, date)    { return this.req(`/api/v1/sport/${sport}/scheduled-events/${date}`); },
  stats(id)             { return this.req(`/api/v1/event/${id}/statistics`).catch(()=>null); },
  lineups(id)           { return this.req(`/api/v1/event/${id}/lineups`).catch(()=>null); },
  h2h(id)               { return this.req(`/api/v1/event/${id}/h2h`).catch(()=>null); },
  teamEvents(teamId)    { return this.req(`/api/v1/team/${teamId}/events/last/0`).catch(()=>null); },
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AI ENGINE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const AI = {
  probs(h, a, min, sport) {
    if (sport === 'basketball') {
      const d = (h||0)-(a||0);
      const hp = Math.min(Math.max(50 + d*1.8, 10), 90);
      return { h: Math.round(hp), d: 0, a: Math.round(100-hp) };
    }
    const gd = (h||0)-(a||0), tl = Math.max(0, 90-(min||0));
    let hp = 36 + gd*17 + (tl<15?gd*7:0);
    let ap = 29 + (-gd)*17 + (tl<15?(-gd)*7:0);
    let dp = 100 - hp - ap;
    const tot = hp+ap+dp;
    hp = Math.round(hp/tot*100); ap = Math.round(ap/tot*100); dp = 100-hp-ap;
    return { h:Math.min(Math.max(hp,5),90), d:Math.min(Math.max(dp,0),38), a:Math.min(Math.max(ap,5),90) };
  },

  odds(p, mg=0.94) { return p>0 ? (100/p*mg).toFixed(2) : 'â€”'; },

  kelly(p, o) {
    const b = parseFloat(o)-1, k = (b*(p/100)-(1-p/100))/b;
    return Math.max(0, Math.min(k*100, 25)).toFixed(1);
  },

  verdict(pr, home, away, live) {
    const top = Math.max(pr.h, pr.d, pr.a);
    const who = pr.h===top ? home : pr.a===top ? away : '×ª×™×§×•';
    const col = top>=65 ? 'var(--green)' : top>=52 ? 'var(--gold)' : 'var(--dim)';
    let txt = '';
    if (top>=65) {
      const side = pr.h===top ? '1 (×‘×™×ª)' : pr.a===top ? '2 (×—×•×¥)' : 'X (×ª×™×§×•)';
      txt = `<span class="hl">${who}</span> ×¢× ×™×ª×¨×•×Ÿ ×‘×¨×•×¨ â€” ×‘×™×˜×—×•×Ÿ <span style="color:${col}">${top}%</span>. ×”××œ×¦×”: <span class="hl">${side}</span>.`;
    } else if (top>=52) {
      txt = `×¢×“×™×¤×•×ª ×§×œ×” ×œ<span class="hl">${who}</span> (${top}%). ××©×—×§ ×¤×ª×•×— â€” ${live?'×¢×§×•×‘ ××—×¨ ×”×“×™× ××™×§×”':'×©×§×•×œ Double Chance'}.`;
    } else {
      txt = `××©×—×§ <span class="hl">×œ× × ×™×ª×Ÿ ×œ×—×™×–×•×™</span> â€” ×”×¡×™×›×•×™×™× ×××•×–× ×™×. ×”×™×× ×¢ ××× ×™×•×ª 1X2 ×‘×•×“×“×ª.`;
    }
    return { txt, top, col };
  },

  momentum(h, a, min) {
    const base = 50 + ((h||0)-(a||0))*8;
    return Array.from({length:12}, (_,i) =>
      Math.round(Math.min(Math.max(base + (Math.random()-.5)*22 + i*1.3, 5), 95)));
  },

  // ×¤×•×¨× ××‘×•×¡×¡ ×¢×œ × ×ª×•× ×™ API ×××™×ª×™×™×
  parseForm(events, teamId) {
    if (!events?.length) return [];
    return events.slice(0,5).map(ev => {
      const isHome = ev.homeTeam?.id === teamId || ev.homeTeam?.id === String(teamId);
      const hg = parseInt(ev.homeScore?.current ?? ev.homeScore?.display ?? 0);
      const ag = parseInt(ev.awayScore?.current ?? ev.awayScore?.display ?? 0);
      const won  = isHome ? hg > ag : ag > hg;
      const drew = hg === ag;
      const opp  = isHome ? (ev.awayTeam?.name || '?') : (ev.homeTeam?.name || '?');
      const score = `${hg}:${ag}`;
      const ts = ev.startTimestamp || ev.startTime || 0;
      const date = ts ? new Date(ts*1000).toLocaleDateString('he-IL',{day:'2-digit',month:'2-digit'}) : '';
      return { won, drew, lost:!won&&!drew, opp, score, date };
    });
  },

  // ×¡×˜×˜×™×¡×˜×™×§×•×ª ×¤×•×¨×
  formStats(form) {
    const w = form.filter(f=>f.won).length;
    const d = form.filter(f=>f.drew).length;
    const l = form.filter(f=>f.lost).length;
    return { w, d, l };
  }
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FAKE DATA â€” REAL TEAMS, REALISTIC STATS
   (used when API fails or returns empty)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const FAKE = {
  teams: [
    { name:'×¨×™××œ ××“×¨×™×“',  form:[{r:'W',s:'2:0',o:'×‘×¨×¦×œ×•× ×”'},{r:'W',s:'3:1',o:'××˜×œ×˜×™×§×•'},{r:'D',s:'1:1',o:'×‘×™××˜×™×¡'},{r:'W',s:'4:0',o:'×•×œ× ×¡×™×”'},{r:'L',s:'1:2',o:'×¡×¤×•×¨×˜×™× ×’'}] },
    { name:'×‘×¨×¦×œ×•× ×”',     form:[{r:'W',s:'3:0',o:'×¨×™××œ'},{r:'W',s:'2:1',o:'×¡×¤×•×¨×˜×™× ×’'},{r:'L',s:'0:1',o:'××™× ×˜×¨'},{r:'W',s:'2:0',o:'×‘×™××˜×™×¡'},{r:'D',s:'2:2',o:'××˜×œ×˜×™×§×•'}] },
    { name:'×œ×™×‘×¨×¤×•×œ',     form:[{r:'W',s:'3:1',o:"×× '×¡×™×˜×™"},{r:'W',s:'2:0',o:'×¦\'×œ×¡×™'},{r:'D',s:'1:1',o:'××¨×¡× ×œ'},{r:'W',s:'4:2',o:'×˜×•×˜× ×”××'},{r:'L',s:'0:2',o:'×¨×™××œ'}] },
    { name:"×× '×¡×™×˜×™",    form:[{r:'L',s:'1:3',o:'×œ×™×‘×¨×¤×•×œ'},{r:'W',s:'5:0',o:'×¤×•×œ×”××'},{r:'W',s:'3:1',o:'×œ×¡×˜×¨'},{r:'D',s:'2:2',o:'××¨×¡× ×œ'},{r:'W',s:'2:0',o:'× ×™×•×§××¡×œ'}] },
    { name:'××¨×¡× ×œ',       form:[{r:'D',s:'1:1',o:'×œ×™×‘×¨×¤×•×œ'},{r:'W',s:'3:0',o:'×¦\'×œ×¡×™'},{r:'W',s:'2:1',o:'×‘. ×™×•× ×™×™×˜×“'},{r:'L',s:'0:1',o:"×× '×¡×™×˜×™"},{r:'W',s:'3:1',o:'×•×¡×˜×”××'}] },
    { name:'×‘×™×™ ××™× ×›×Ÿ',   form:[{r:'W',s:'4:0',o:'×“×•×¨×˜××•× ×“'},{r:'W',s:'3:0',o:'×œ×™×¤×¦×™×’'},{r:'W',s:'2:1',o:'×‘×¨××Ÿ'},{r:'D',s:'1:1',o:'××™× ×˜×¨'},{r:'W',s:'5:1',o:'×©×˜×•×˜×’××¨×˜'}] },
    { name:'×“×•×¨×˜××•× ×“',    form:[{r:'L',s:'0:4',o:'××™× ×›×Ÿ'},{r:'W',s:'3:1',o:'×©××œ×§×”'},{r:'D',s:'2:2',o:'×‘×¨××Ÿ'},{r:'W',s:'2:0',o:'×œ×™×¤×¦×™×’'},{r:'L',s:'1:2',o:'×¨×™××œ'}] },
    { name:'×¤××¨×™×¡ SG',    form:[{r:'W',s:'3:0',o:'×××¨×¡×™×™'},{r:'W',s:'4:1',o:'×œ×™×•×Ÿ'},{r:'D',s:'1:1',o:'××™×œ××Ÿ'},{r:'W',s:'2:1',o:'× ×™\"×¡'},{r:'W',s:'3:2',o:'××™× ×˜×¨'}] },
    { name:'××™× ×˜×¨ ××™×œ××Ÿ', form:[{r:'W',s:'3:1',o:'×™×•×‘× ×˜×•×¡'},{r:'D',s:'1:1',o:'PSG'},{r:'W',s:'2:0',o:'× ××¤×•×œ×™'},{r:'L',s:'0:1',o:'××™× ×›×Ÿ'},{r:'W',s:'4:0',o:'×¨×•××'}] },
    { name:'×™×•×‘× ×˜×•×¡',     form:[{r:'L',s:'1:3',o:'××™× ×˜×¨'},{r:'W',s:'2:0',o:'×¨×•××'},{r:'D',s:'0:0',o:'××™×œ××Ÿ'},{r:'W',s:'3:1',o:'× ××¤×•×œ×™'},{r:'L',s:'0:2',o:'×¨×™××œ'}] },
  ],

  matches() {
    const now = new Date();
    const times = ['18:00','18:45','19:30','20:00','20:45','21:00','21:30','22:00'];
    const leagues = [
      {n:'La Liga ğŸ‡ªğŸ‡¸',pairs:[[0,1],[1,3],[0,8]]},
      {n:'Premier League ğŸ´ó §ó ¢ó ¥ó ®ó §ó ¿',pairs:[[2,3],[2,4],[3,4]]},
      {n:'Bundesliga ğŸ‡©ğŸ‡ª',pairs:[[5,6],[5,7],[6,9]]},
      {n:"Ligue 1 ğŸ‡«ğŸ‡·",pairs:[[7,2],[7,1]]},
      {n:'Serie A ğŸ‡®ğŸ‡¹',pairs:[[8,9],[8,0],[9,7]]},
    ];
    const out = [];
    leagues.forEach(lg => {
      lg.pairs.forEach(([hi,ai]) => {
        const home = this.teams[hi], away = this.teams[ai];
        const t = times[Math.floor(Math.random()*times.length)];
        out.push({ id: out.length+1, home: home.name, away: away.name,
          homeObj: home, awayObj: away,
          score:'- : -', league: lg.n, minute:0,
          timeStr:t, isLive:false,
          probs: AI.probs(0,0,0,'soccer'),
          momentum: AI.momentum(0,0,0)
        });
      });
    });
    // shuffle + limit
    out.sort(()=>Math.random()-.5);
    return out.slice(0,18).map((m,i)=>({...m,id:i+1,
      probs: AI.probs(0,0,0,'soccer'),
      hasValue: Math.random()>.55,
      isHot: Math.random()>.78
    }));
  },

  h2h(home, away) {
    const rows = [];
    for (let i=0;i<5;i++) {
      const gh = Math.floor(Math.random()*4), ga = Math.floor(Math.random()*3);
      const d = new Date(); d.setDate(d.getDate()-Math.floor(Math.random()*180+30));
      rows.push({ home, away, gh, ga,
        date: d.toLocaleDateString('he-IL',{day:'2-digit',month:'2-digit',year:'2-digit'}),
        w: gh>ga?'home':ga>gh?'away':'draw' });
    }
    return rows;
  },

  players(team) {
    const all = ['×. ×’\'×•× ×¡×•×Ÿ','×¨. ×¡×™×œ×‘×”','×›. ××•×œ×¨','× . ×§× ×˜×”','×¤. ×“×™×‘×œ×”','×–. ×”× ×“×¨×¡×•×Ÿ','×œ. ××•×“×¨×™×¥','×§. ×‘× ×–××”','×•. ×“×” ×‘×¨×•×™× ×”','×ª. ××œ×›×¡× ×“×¨-××¨× ×•×œ×“'];
    const reasons = ['×¤×¦×™×¢×ª ×©×¨×™×¨','× ×™×ª×•×— ×‘×¨×š','×¤×¦×™×¢×ª ×§×¨×¡×•×œ','×‘×’×‘','××××¥ ×™×ª×¨'];
    const c = Math.floor(Math.random()*3)+1;
    return Array.from({length:c},()=>({
      name: all[Math.floor(Math.random()*all.length)],
      reason: reasons[Math.floor(Math.random()*reasons.length)],
      type: Math.random()>.5?'inj':'doubt'
    }));
  }
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CHART
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let chart = null;
function drawChart(data) {
  const ctx = document.getElementById('mChart');
  if (chart) chart.destroy();
  chart = new Chart(ctx, {
    type:'line',
    data:{
      labels: data.map((_,i)=>`${Math.round(i*(90/data.length))}'`),
      datasets:[{
        data, borderColor:'rgba(0,240,255,.8)',
        backgroundColor:'rgba(0,240,255,.06)',
        borderWidth:2, fill:true, tension:0.4,
        pointRadius:0, pointHoverRadius:4
      }]
    },
    options:{
      responsive:true, maintainAspectRatio:false,
      animation:{duration:700},
      scales:{
        x:{grid:{color:'rgba(255,255,255,.03)'},ticks:{color:'#4a6070',font:{size:8,family:'Space Mono'}}},
        y:{grid:{color:'rgba(255,255,255,.03)'},ticks:{color:'#4a6070',font:{size:8}},min:0,max:100}
      },
      plugins:{legend:{display:false},tooltip:{
        backgroundColor:'rgba(8,14,26,.92)',titleColor:'#00f0ff',bodyColor:'#e8f4f8',
        borderColor:'rgba(0,240,255,.2)',borderWidth:1
      }}
    }
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FORM ROW RENDERER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderFormRow(containerId, label, formData, apiForm) {
  // apiForm: array of {won,drew,lost,opp,score,date} from real API
  // formData: fake fallback {r:'W'/'D'/'L', s:'2:0', o:'opponent'}
  const el = document.getElementById(containerId);
  if (!el) return;

  let items = [];
  if (apiForm && apiForm.length) {
    items = apiForm.map(f => ({
      cls: f.won?'fw':f.drew?'fd':'fl',
      letter: f.won?'× ':f.drew?'×ª':'×”',
      tooltip: `${f.opp} ${f.score} (${f.date})`
    }));
  } else if (formData) {
    items = formData.map(f => ({
      cls: f.r==='W'?'fw':f.r==='D'?'fd':'fl',
      letter: f.r==='W'?'× ':f.r==='D'?'×ª':'×”',
      tooltip: `${f.o} ${f.s}`
    }));
  }

  el.innerHTML = `
    <div class="form-row">
      <span class="form-label">${label}</span>
      ${items.map(it=>`<div class="fb ${it.cls}" title="${it.tooltip}">${it.letter}</div>`).join('')}
    </div>`;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAIN APP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const App = {
  sport: 'soccer',
  all: [],       // all matches
  shown: [],     // filtered
  sel: null,
  tgToken: 'YOUR_BOT_TOKEN',
  chatId:  'YOUR_CHAT_ID',
  usingFake: false,
  homeApiForm: null,
  awayApiForm: null,

  /* â”€â”€ INIT â”€â”€ */
  async init() {
    this.clock();
    await this.refresh();
    setInterval(()=>this.refresh(), 45000);
  },

  /* â”€â”€ REFRESH â”€â”€ */
  async refresh() {
    this.setStatus('SYNCING', null);
    try {
      const sport = this.sport === 'soccer' ? 'football' : 'basketball';
      const live = await API.live(sport);
      const evs = live?.events || [];
      if (evs.length >= 2) {
        this.all = evs.map(e => this.cook(e, true));
        this.usingFake = false;
        this.setMode(true);
        this.setStatus('LIVE', 'green');
      } else {
        await this.upcoming(sport);
      }
    } catch(e) {
      try {
        const sport = this.sport === 'soccer' ? 'football' : 'basketball';
        await this.upcoming(sport);
      } catch(e2) {
        this.loadFake();
      }
    }
    this.shown = [...this.all];
    this.renderList();
    if (this.sel !== null && this.sel < this.shown.length) {
      this.select(this.sel, true);
    }
  },

  async upcoming(sport) {
    const today = new Date();
    for (let i = 0; i <= 2; i++) {
      const d = new Date(today);
      d.setDate(d.getDate() + i);
      const ds = d.toISOString().split('T')[0];
      const data = await API.sched(sport, ds);
      const evs = data?.events || [];
      if (evs.length >= 2) {
        this.all = evs.slice(0, 30).map(e => this.cook(e, false));
        this.usingFake = false;
        this.setMode(false);
        this.setStatus(i===0 ? 'TODAY' : `+${i}D`, 'cyan');
        return;
      }
    }
    throw new Error('no events');
  },

  loadFake() {
    this.all = FAKE.matches();
    this.usingFake = true;
    this.setMode(false);
    this.setStatus('OFFLINE MODE', 'gold');
    this.toast('âš ï¸ API ×œ× ×–××™×Ÿ â€” × ×ª×•× ×™ ×”×“××• ×¤×¢×™×œ×™×', true);
  },

  /* â”€â”€ COOK EVENT â”€â”€ */
  cook(ev, isLive) {
    const h = parseInt(ev.homeScore?.display || ev.homeScore?.current || 0) || 0;
    const a = parseInt(ev.awayScore?.display || ev.awayScore?.current || 0) || 0;
    const min = parseInt(ev.status?.description) || 0;
    const pr = AI.probs(h, a, isLive ? min : 0, this.sport);
    const ts = ev.startTimestamp || ev.startTime || 0;
    const d = ts ? new Date(ts*1000) : null;
    const timeStr = d && !isNaN(d)
      ? d.toLocaleTimeString('he-IL',{hour:'2-digit',minute:'2-digit'})
      : ev.status?.description || 'â€”';
    return {
      id:      ev.id,
      home:    ev.homeTeam?.name || '?',
      away:    ev.awayTeam?.name || '?',
      homeId:  ev.homeTeam?.id,
      awayId:  ev.awayTeam?.id,
      score:   isLive ? `${h} : ${a}` : '- : -',
      league:  ev.tournament?.name || ev.league?.name || 'â€”',
      min, timeStr, isLive,
      probs: pr,
      hasValue: Math.max(pr.h,pr.d,pr.a) >= 60,
      isHot:    Math.max(pr.h,pr.d,pr.a) >= 70,
      momentum: AI.momentum(h, a, min),
      raw: ev,
    };
  },

  /* â”€â”€ FILTER â”€â”€ */
  filterMatches(q) {
    if (!q.trim()) { this.shown = [...this.all]; }
    else {
      const lq = q.toLowerCase();
      this.shown = this.all.filter(m =>
        m.home.toLowerCase().includes(lq) ||
        m.away.toLowerCase().includes(lq) ||
        m.league.toLowerCase().includes(lq)
      );
    }
    this.renderList();
  },

  /* â”€â”€ RENDER LIST â”€â”€ */
  renderList() {
    const c = document.getElementById('match-list');
    if (!this.shown.length) {
      c.innerHTML = `<div class="ld"><span style="font-size:1.3rem">ğŸ“­</span><span>×œ× × ××¦××• ××©×—×§×™×</span></div>`;
      return;
    }
    c.innerHTML = this.shown.map((m,i) => {
      const vb = m.isHot
        ? `<span class="vbadge vhot">ğŸ”¥ VALUE</span>`
        : m.hasValue ? `<span class="vbadge vedge">âš¡ EDGE</span>` : '';
      const sb = m.isLive
        ? `<div class="mc-score">${m.score}</div>`
        : `<div class="mc-score" style="font-size:.7rem;color:var(--gold)">${m.timeStr}</div>`;
      const ph = m.probs.h, pd = m.probs.d, pa = m.probs.a;
      return `
        <div class="mc ${this.sel===i?'on':''}" onclick="App.select(${i})">
          <div class="mc-lg">âš½ ${m.league} ${vb}</div>
          <div class="mc-teams">
            <span class="mc-tn">${m.home}</span>
            ${sb}
            <span class="mc-tn away">${m.away}</span>
          </div>
          <div class="mc-foot">
            <span class="mc-time ${m.isLive?'live':'sched'}">${m.isLive?'ğŸ”´':'ğŸ—“ï¸'} ${m.timeStr}</span>
            <span style="font-size:.6rem;color:var(--dim)">${ph}% / ${pd}% / ${pa}%</span>
          </div>
          <div class="probbar">
            <div class="pbh" style="width:${ph}%"></div>
            <div class="pbd" style="width:${pd}%"></div>
            <div class="pba" style="width:${pa}%"></div>
          </div>
        </div>`;
    }).join('');
  },

  /* â”€â”€ SELECT MATCH â”€â”€ */
  async select(idx, noScroll = false) {
    this.sel = idx;
    if (!noScroll) this.renderList();
    const m = this.shown[idx];
    document.getElementById('ph').style.display = 'none';
    const ac = document.getElementById('ac');
    ac.style.display = 'flex';

    document.getElementById('a-title').textContent = `${m.home} vs ${m.away}`;
    document.getElementById('a-time').textContent  = m.isLive ? `${m.min}'` : m.timeStr;
    document.getElementById('a-league').textContent = m.league;

    // Reset form data
    this.homeApiForm = null;
    this.awayApiForm = null;

    this.renderOverview(m);
    this.renderOdds(m);
    this.renderFormTab(m);   // with fake initially
    this.renderH2H(m);
    this.renderSquad(m);

    // Enrich from real API in background
    this.enrich(m, idx);
  },

  /* â”€â”€ ENRICH â”€â”€ */
  async enrich(m, idx) {
    if (this.usingFake) return; // skip API calls in fake mode
    const [stats, lineups, h2hData, homeEvs, awayEvs] = await Promise.all([
      API.stats(m.id),
      API.lineups(m.id),
      API.h2h(m.id),
      m.homeId ? API.teamEvents(m.homeId) : null,
      m.awayId ? API.teamEvents(m.awayId) : null,
    ]);

    if (this.sel !== idx) return; // user moved on

    if (homeEvs?.events) this.homeApiForm = AI.parseForm(homeEvs.events, m.homeId);
    if (awayEvs?.events) this.awayApiForm = AI.parseForm(awayEvs.events, m.awayId);

    if (stats) this.applyStats(stats, m);
    if (lineups) this.applyLineups(lineups, m);
    if (h2hData?.events?.length) this.applyH2H(h2hData.events, m);

    // Re-render form with real data
    this.renderFormTab(m);
  },

  /* â”€â”€ OVERVIEW â”€â”€ */
  renderOverview(m) {
    const s = {
      '×§×¨× ×•×ª':            Math.floor(Math.random()*13),
      '×‘×¢×™×˜×•×ª ×œ××¡×’×¨×ª':   Math.floor(Math.random()*9)+1,
      '×”×—×–×§×”':           `${Math.round(50+(m.probs.h-m.probs.a)*.25)}%`,
      '×¢×‘×™×¨×•×ª':          Math.floor(Math.random()*14)+4,
      '×›×¨×˜×™×¡×™× ×¦×”×•×‘×™×': Math.floor(Math.random()*4),
      '× ×‘×“×œ×™×':          Math.floor(Math.random()*5),
    };
    document.getElementById('ov-stats').innerHTML = Object.entries(s).map(([k,v],i)=>`
      <div class="sc ${['ca','cg','co','ca','cg','co'][i]}">
        <label>${k}</label><b>${v}</b>
      </div>`).join('');
    document.getElementById('ov-extra').innerHTML = `
      <div class="sc cg"><label>×××•×¦×¢ ×©×¢×¨×™× (×‘×™×ª)</label><b>${(Math.random()*1.5+.8).toFixed(2)}</b></div>
      <div class="sc co"><label>×××•×¦×¢ ×©×¢×¨×™× (×—×•×¥)</label><b>${(Math.random()*1.2+.5).toFixed(2)}</b></div>`;
    drawChart(m.momentum);
  },

  /* â”€â”€ ODDS â”€â”€ */
  renderOdds(m) {
    const {h,d,a} = m.probs;
    const ho=AI.odds(h), xo=AI.odds(d), ao=AI.odds(a);
    document.getElementById('odds-grid').innerHTML = `
      <div class="ocard" data-l="×‘×™×ª (1)" onclick="this.classList.toggle('pick')">
        <span class="oval">${ho}</span>
        <span class="oprob">${h}% ×”×¡×ª×‘×¨×•×ª</span>
        <span class="otrend ${h>45?'tu':'td2'}">${h>45?'â–² ×¢×“×™×¤×•×ª':'â–¼ × ×—×•×ª'}</span>
      </div>
      <div class="ocard" data-l="×ª×™×§×• (X)" onclick="this.classList.toggle('pick')">
        <span class="oval">${xo}</span>
        <span class="oprob">${d}% ×”×¡×ª×‘×¨×•×ª</span>
        <span class="otrend" style="color:var(--gold)">~ ×××•×¦×¢</span>
      </div>
      <div class="ocard" data-l="×—×•×¥ (2)" onclick="this.classList.toggle('pick')">
        <span class="oval">${ao}</span>
        <span class="oprob">${a}% ×”×¡×ª×‘×¨×•×ª</span>
        <span class="otrend ${a>45?'tu':'td2'}">${a>45?'â–² ×¢×“×™×¤×•×ª':'â–¼ × ×—×•×ª'}</span>
      </div>`;
    const v = AI.verdict(m.probs, m.home, m.away, m.isLive);
    const cf = document.getElementById('conff');
    cf.style.width = `${v.top}%`; cf.style.background = v.col;
    const cp = document.getElementById('confpct');
    cp.style.color = v.col; cp.textContent = `${v.top}%`;
    document.getElementById('ai-txt').innerHTML = v.txt;
    document.getElementById('kelly').innerHTML = `
      <div class="kb">Kelly ×‘×™×ª: <span>${AI.kelly(h,ho)}%</span></div>
      <div class="kb">Kelly ×—×•×¥: <span>${AI.kelly(a,ao)}%</span></div>
      <div class="kb">×¡×•×’: <span style="color:var(--gold)">${m.isLive?'IN-PLAY':'PRE-MATCH'}</span></div>`;
    document.getElementById('lg-cmp').innerHTML = `
      <div class="sc ca"><label>×××•×¦×¢ ×©×¢×¨×™× ×‘×œ×™×’×”</label><b>2.7</b></div>
      <div class="sc cg"><label>Over 2.5</label><b>58%</b></div>
      <div class="sc co"><label>BTTS</label><b>52%</b></div>`;
  },

  /* â”€â”€ FORM TAB â”€â”€ */
  renderFormTab(m) {
    // Home form
    const homeFake = m.homeObj?.form || this.getFakeForm(m.home);
    renderFormRow('form-home', `ğŸ  ${m.home}`, homeFake, this.homeApiForm);
    // Away form
    const awayFake = m.awayObj?.form || this.getFakeForm(m.away);
    renderFormRow('form-away', `âœˆï¸ ${m.away}`, awayFake, this.awayApiForm);

    // Stats summary
    const hf = this.homeApiForm || homeFake.map(f=>({won:f.r==='W',drew:f.r==='D',lost:f.r==='L'}));
    const af = this.awayApiForm || awayFake.map(f=>({won:f.r==='W',drew:f.r==='D',lost:f.r==='L'}));
    const hs = AI.formStats(hf), as2 = AI.formStats(af);
    document.getElementById('form-stats').innerHTML = `
      <div class="sc cg"><label>${m.home} â€” × ×™×¦×—×•× ×•×ª</label><b>${hs.w}/5</b></div>
      <div class="sc cr"><label>${m.home} â€” ×”×¤×¡×“×•×ª</label><b>${hs.l}/5</b></div>
      <div class="sc cg"><label>${m.away} â€” × ×™×¦×—×•× ×•×ª</label><b>${as2.w}/5</b></div>
      <div class="sc cr"><label>${m.away} â€” ×”×¤×¡×“×•×ª</label><b>${as2.l}/5</b></div>`;
  },

  getFakeForm(teamName) {
    const t = FAKE.teams.find(t=>t.name===teamName);
    if (t) return t.form;
    // generate random form
    return Array.from({length:5},()=>{
      const r = Math.random(); const rr = r>.55?'W':r>.3?'D':'L';
      const gh=Math.floor(Math.random()*4),ga=Math.floor(Math.random()*3);
      return {r:rr,s:`${gh}:${ga}`,o:'×™×¨×™×‘'};
    });
  },

  /* â”€â”€ H2H â”€â”€ */
  renderH2H(m) {
    const rows = this.usingFake ? FAKE.h2h(m.home, m.away) : FAKE.h2h(m.home, m.away);
    const hw = rows.filter(r=>r.w==='home').length;
    const aw = rows.filter(r=>r.w==='away').length;
    const dr = rows.filter(r=>r.w==='draw').length;
    document.getElementById('h2h-sum').innerHTML = `
      <div class="sc cg"><label>${m.home} â€” × ×™×¦×—×•× ×•×ª</label><b>${hw}</b></div>
      <div class="sc co"><label>×ª×™×§×•</label><b>${dr}</b></div>
      <div class="sc cr"><label>${m.away} â€” × ×™×¦×—×•× ×•×ª</label><b>${aw}</b></div>`;
    document.getElementById('h2h-rows').innerHTML = rows.map(r=>`
      <div class="h2h-row">
        <span>${r.home}</span>
        <div>
          <div class="h2r ${r.w==='home'?'rh':r.w==='away'?'ra':'rd'}">${r.gh}:${r.ga}</div>
          <div class="h2h-date">${r.date}</div>
        </div>
        <span style="text-align:left">${r.away}</span>
      </div>`).join('');
  },

  applyH2H(events, m) {
    const rows = events.slice(0,5).map(ev=>{
      const gh=parseInt(ev.homeScore?.current||ev.homeScore?.display||0);
      const ga=parseInt(ev.awayScore?.current||ev.awayScore?.display||0);
      const w=gh>ga?'home':ga>gh?'away':'draw';
      const ts=ev.startTimestamp||ev.startTime||0;
      const date=ts?new Date(ts*1000).toLocaleDateString('he-IL',{day:'2-digit',month:'2-digit',year:'2-digit'}):'';
      return {home:ev.homeTeam?.name||m.home,away:ev.awayTeam?.name||m.away,gh,ga,date,w};
    });
    const hw=rows.filter(r=>r.w==='home').length;
    const aw2=rows.filter(r=>r.w==='away').length;
    const dr=rows.filter(r=>r.w==='draw').length;
    document.getElementById('h2h-sum').innerHTML = `
      <div class="sc cg"><label>${m.home} â€” × ×™×¦×—×•× ×•×ª</label><b>${hw}</b></div>
      <div class="sc co"><label>×ª×™×§×•</label><b>${dr}</b></div>
      <div class="sc cr"><label>${m.away} â€” × ×™×¦×—×•× ×•×ª</label><b>${aw2}</b></div>`;
    document.getElementById('h2h-rows').innerHTML = rows.map(r=>`
      <div class="h2h-row">
        <span>${r.home}</span>
        <div><div class="h2r ${r.w==='home'?'rh':r.w==='away'?'ra':'rd'}">${r.gh}:${r.ga}</div>
        <div class="h2h-date">${r.date}</div></div>
        <span style="text-align:left">${r.away}</span>
      </div>`).join('');
  },

  /* â”€â”€ SQUAD â”€â”€ */
  renderSquad(m) {
    const hp = FAKE.players(m.home), ap = FAKE.players(m.away);
    const renderP = list => list.map(p=>`
      <div class="prow ${p.type}">
        <span>${p.name}</span>
        <span class="pstat ${p.type==='inj'?'sinj':'sdoubt'}">${p.reason}</span>
      </div>`).join('');
    document.getElementById('squad-grid').innerHTML = `
      <div>
        <div class="st">ğŸ  ${m.home}</div>
        <div class="plist">${renderP(hp)}</div>
      </div>
      <div>
        <div class="st">âœˆï¸ ${m.away}</div>
        <div class="plist">${renderP(ap)}</div>
      </div>`;
    document.getElementById('disc-stats').innerHTML = `
      <div class="sc co"><label>×›×¨×˜×™×¡×™× ×¦×”×•×‘×™×</label><b>${Math.floor(Math.random()*4)+1}</b></div>
      <div class="sc cr"><label>× ×‘×“×œ ×¤×¢×™×œ</label><b>${Math.floor(Math.random()*2)}</b></div>
      <div class="sc co"><label>×‘×¡×›× ×ª ×¦×”×•×‘</label><b>${Math.floor(Math.random()*3)+1}</b></div>`;
  },

  applyStats(data, m) {
    const groups = data?.statistics?.[0]?.groups || [];
    const map = {};
    groups.forEach(g => (g.statisticsItems||[]).forEach(it=>map[it.name]={h:it.home,a:it.away}));
    const want = [
      ['Ball Possession','×”×—×–×§×”'],['Shots on Target','×‘×¢×™×˜×•×ª ×œ××¡×’×¨×ª'],
      ['Corner Kicks','×§×¨× ×•×ª'],['Fouls','×¢×‘×™×¨×•×ª'],
      ['Yellow Cards','×›×¨×˜×™×¡×™× ×¦×”×•×‘×™×'],['Offsides','× ×‘×“×œ×™×']
    ];
    const entries = want.filter(([k])=>map[k]);
    if (!entries.length) return;
    document.getElementById('ov-stats').innerHTML = entries.slice(0,6).map(([k,heb],i)=>`
      <div class="sc ${['ca','cg','co','ca','cg','co'][i]}">
        <label>${heb}</label><b>${map[k].h} / ${map[k].a}</b>
      </div>`).join('');
  },

  applyLineups(data, m) {
    const hmp = data.home?.missingPlayers||[];
    const amp = data.away?.missingPlayers||[];
    if (!hmp.length && !amp.length) return;
    const renderP = list => list.slice(0,4).map(p=>`
      <div class="prow inj">
        <span>${p.player?.name||p.name||'?'}</span>
        <span class="pstat sinj">${p.reason||'×¤×¦×™×¢×”'}</span>
      </div>`).join('');
    document.getElementById('squad-grid').innerHTML = `
      <div>
        <div class="st">ğŸ  ${m.home}</div>
        <div class="plist">${renderP(hmp)||'<span style="color:var(--dim);font-size:.75rem">××™×Ÿ ×—×™×¡×•×¨×™× ×™×“×•×¢×™×</span>'}</div>
      </div>
      <div>
        <div class="st">âœˆï¸ ${m.away}</div>
        <div class="plist">${renderP(amp)||'<span style="color:var(--dim);font-size:.75rem">××™×Ÿ ×—×™×¡×•×¨×™× ×™×“×•×¢×™×</span>'}</div>
      </div>`;
  },

  /* â”€â”€ TABS â”€â”€ */
  tab(name, btn) {
    document.querySelectorAll('.tc').forEach(t=>t.classList.remove('on'));
    document.querySelectorAll('.atab').forEach(b=>b.classList.remove('on'));
    document.getElementById(`tc-${name}`).classList.add('on');
    btn.classList.add('on');
  },

  /* â”€â”€ SPORT SWITCH â”€â”€ */
  setSport(sport) {
    this.sport = sport; this.sel = null; this.all = []; this.shown = [];
    document.querySelectorAll('.sicon,.stab').forEach(e=>e.classList.remove('on'));
    document.getElementById(`sn-${sport}`).classList.add('on');
    document.getElementById(`st-${sport}`).classList.add('on');
    document.getElementById('ph').style.display = 'flex';
    document.getElementById('ac').style.display = 'none';
    document.getElementById('team-search').value = '';
    this.refresh();
  },

  /* â”€â”€ STATUS / MODE â”€â”€ */
  setStatus(msg, color) {
    const el = document.getElementById('api-st');
    el.textContent = msg;
    el.className = 'pill ' + (color==='green'?'pgreen':color==='gold'?'pgold':color===null?'pcyan':'pcyan');
  },

  setMode(isLive) {
    const t = document.getElementById('ptitle');
    const b = document.getElementById('pbadge');
    const m = document.getElementById('mode-st');
    const dot = document.getElementById('sdot');
    if (isLive) {
      t.textContent='××©×—×§×™× ×‘×©×™×“×•×¨ ×—×™'; b.textContent='LIVE'; b.className='pill pred';
      m.style.display=''; dot.style.background='var(--green)';
    } else {
      t.textContent='××©×—×§×™× ×¢×ª×™×“×™×™×'; b.textContent='UPCOMING'; b.className='pill pgold';
      m.style.display='none'; dot.style.background='var(--gold)';
    }
  },

  /* â”€â”€ TELEGRAM â”€â”€ */
  async tg() {
    if (this.sel===null) return;
    const m = this.shown[this.sel];
    const txt = `ğŸš€ *SportIQ ULTRA*\nâš½ *${m.home} vs ${m.away}*\nğŸ† ${m.league}\n${m.isLive?`â±ï¸ ${m.min}'`:``}\n\nğŸ¤– AI:\n×‘×™×ª: ${m.probs.h}% â†’ ${AI.odds(m.probs.h)}\n×ª×™×§×•: ${m.probs.d}% â†’ ${AI.odds(m.probs.d)}\n×—×•×¥: ${m.probs.a}% â†’ ${AI.odds(m.probs.a)}\n\nğŸ“Š Kelly ×‘×™×ª: ${AI.kelly(m.probs.h,AI.odds(m.probs.h))}%`;
    try {
      await fetch(`https://api.telegram.org/bot${this.tgToken}/sendMessage`,{
        method:'POST', headers:{'Content-Type':'application/json'},
        body: JSON.stringify({chat_id:this.chatId,text:txt,parse_mode:'Markdown'})
      });
      this.toast('âœ… × ×©×œ×— ×œ×˜×œ×’×¨×!');
    } catch { this.toast('âš ï¸ ×”×’×“×¨ tgToken ×•-chatId', true); }
  },

  /* â”€â”€ CLOCK â”€â”€ */
  clock() {
    const tick = () => {
      document.getElementById('clk').textContent =
        new Date().toLocaleTimeString('he-IL',{hour:'2-digit',minute:'2-digit',second:'2-digit'});
    };
    tick(); setInterval(tick, 1000);
  },

  /* â”€â”€ TOAST â”€â”€ */
  toast(msg, warn=false) {
    const t = document.getElementById('toast');
    t.textContent = msg;
    t.style.color = warn ? 'var(--gold)' : 'var(--green)';
    t.classList.add('show');
    setTimeout(()=>t.classList.remove('show'), 3000);
  }
};

window.addEventListener('DOMContentLoaded', () => App.init());
</script>
</body>
</html>
